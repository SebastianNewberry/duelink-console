import{r as e,a as t,c as s,b as o,u as n,d as i,V as a,n as r,t as l,w as d,v as c,F as u,o as p,e as h,f as w}from"./vendor.e01eb0c6.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class f{constructor(){this.errorLog=[],this.port=null,this.reader=null,this.writer=null,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.readLoopActive=!1,this.readLoopPromise=null,this.output=[],this.isConnected=!1}async connect(){this.port=await navigator.serial.requestPort({usbVendorId:7071});try{await this.attach()}catch(e){this.errorLog.push(e),this.port=null}await this.sleep(100),await this.synchronize(),await this.send(">"),await this.send("echo(0)"),this.startReadLoop(),this.isConnected=!0}async synchronize(){await this.send("",""),await this.send("version()")}async disconnect(){await this.detach()}async attach(){var e,t;await this.port.open({baudRate:115200,dataBits:8,parity:"none",stopBits:1,flowControl:"none"}),null==(null==(e=this.port)?void 0:e.writable)&&this.errorLog.push("This is not a writable port."),null==(null==(t=this.port)?void 0:t.readable)&&this.errorLog.push("This is not a readable port."),this.reader=this.port.readable.getReader(),this.writer=this.port.writable.getWriter()}async sleep(e){await new Promise((t=>setTimeout(t,e)))}async detach(){await this.stopReadLoop(),await this.writer.releaseLock(),await this.reader.releaseLock(),await this.port.close()}startReadLoop(){this.readLoopPromise=this.readLoop()}async stopReadLoop(){this.readLoopActive=!1,this.readLoopPromise&&(await this.reader.cancel(),await this.readLoopPromise,this.readLoopPromise=null)}async readResponse(e=!0){let t=this.leftOver;const s=Date.now()+this.readTimeout,o={success:!1,response:null};for(;Date.now()<s;){const{value:e,_:s}=await this.reader.read();if(e){t+=this.decoder.decode(e),t=t.replace("\n",""),t=t.replace("\r","");let s=t.indexOf(">"),n=t.indexOf("&");if(-1===s&&(s=t.indexOf("$")),-1===s&&-1===n)continue;const i=-1===s?n:s;console.log("----------",i),console.log(t),console.log("----------"),console.log(i+1,t.length,t.substring(i+1,t.length)),console.log("----------"),console.log(0,i,t.substring(0,i)),this.leftOver=t.substring(i+1),o.success=!0,o.response=t.substring(0,i);return-1!==t.indexOf("!")&&(o.response.indexOf("error")>-1||o.response.indexOf("unknown")>-1)&&(o.success=!1),o}}}async readResponse2(){let e="";try{for(;;){console.log("reading...");const{value:t,done:s}=await this.reader.read();if(t){const s=this.decoder.decode(t);e+=s,console.log("value",s)}else console.log("no value");if(s){console.log("done");break}console.log("not done")}}catch(t){console.error(t)}return e}async send(e,t="\n"){e+=t,this.writer.write(this.encoder.encode(e)),console.log(e),await this.sleep(1)}async readLoop(){let e="";for(this.readLoopActive=!0;this.readLoopActive;)try{const{value:t,done:s}=await this.reader.read();if(t){e+=this.decoder.decode(t);const s=e.indexOf("\n");s>-1&&(this.output.push(e.substring(0,s).replace("\r","")),e=e.substring(s+1))}s&&(this.readLoopActive=!1)}catch(t){console.error(t);break}}}const g={class:"mb-4"},b={class:"grid grid-cols-2 gap-4 bg-gray-200"},v={class:"col-span-1 space-y-4"},y={key:1,class:"bg-white w-full h-[600px]"},m={class:"flex divide-x divide-gray-400"},x=["disabled"],L=["disabled"],C=["disabled"],k={class:"col-span-1 space-y-4"},O={class:"flex divide-x divide-gray-400"},P=["disabled"],R={class:"col-span-1"},S={class:"flex"},T=["disabled"],W=["disabled"],A=o("hr",{class:"my-2 h-px bg-gray-400 text-gray-400"},null,-1),D={class:"mt-4 flex divide-x divide-gray-400"},N=["disabled"],j=["disabled"],z={setup(h){const w=e(""),z=e(""),I=e(null),V=e(1),$=e(1),q=e("javascript"),B=t(new f);async function E(){console.log("Send recording mode code"),await B.send("$");const e=w.value.replace("\r","").split("\n");for(const t of e)await B.send(t);await B.send("run")}async function U(){console.log("Send immediate mode code"),await B.send(z.value)}async function F(){console.log("Send list"),await B.send("list")}async function H(){console.log("Send new"),await B.send("new")}async function K(){await B.send('print("Hello World")')}async function M(){const e=["for x = 1 to 10","DWrite(100,1)","Wait(200)","DWrite(100,0)","Wait(200)","next"];await B.send("$");for(const t of e)await B.send(t);await B.send("run")}function _(e){e.setOptions({fontSize:"16px"}),e.session.selection.on("changeCursor",(()=>{const t=e.getCursorPosition();V.value=t.row+1,$.value=t.column+1})),e.value=e}return e(!0),(e,t)=>(p(),s(u,null,[o("div",g,[o("button",{onClick:t[0]||(t[0]=(...e)=>n(B).connect&&n(B).connect(...e))},"Connect")]),o("div",b,[o("div",v,[n(B).isConnected?(p(),i(n(a),{key:0,value:w.value,"onUpdate:value":t[1]||(t[1]=e=>w.value=e),lang:q.value,class:"w-full h-[600px]",disabled:!n(B).isConnected,ref:I,onInit:_},null,8,["value","lang","disabled"])):(p(),s("div",y)),o("div",m,[o("button",{disabled:!n(B).isConnected,onClick:E},"Send",8,x),o("button",{disabled:!n(B).isConnected,onClick:F},"List",8,L),o("button",{disabled:!n(B).isConnected,onClick:H},"New",8,C)])]),o("div",k,[o("div",{class:r(["w-full h-[600px] p-4 bg-black overflow-y-auto whitespace-pre-wrap text-white",n(B).isConnected?"":"opacity-40"])},l(n(B).output.join("\n")),3),o("div",O,[o("button",{disabled:!n(B).isConnected,onClick:t[2]||(t[2]=e=>n(B).output.length=0)},"Clear",8,P)])]),o("div",R,[o("div",S,[d(o("input",{disabled:!n(B).isConnected,"onUpdate:modelValue":t[3]||(t[3]=e=>z.value=e),type:"text",class:"flex-1"},null,8,T),[[c,z.value]]),o("button",{disabled:!n(B).isConnected,onClick:U},"Send",8,W)]),A,o("div",D,[o("button",{disabled:!n(B).isConnected,onClick:K},"Test Print",8,N),o("button",{disabled:!n(B).isConnected,onClick:M},"Test Digital Write",8,j)])])])],64))}};window.ace=h,w(z).mount("#app");
