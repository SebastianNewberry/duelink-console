import{C as e,r as t,a as s,c as i,b as o,d as a,u as n,t as r,e as l,V as c,w as d,v as u,f as h,g as p,n as w,F as g,h as f,o as v,i as y,j as b}from"./vendor.51010646.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class m{constructor(){this.port=null,this.reader=null,this.writer=null,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.queue=new e,this.readLoopActive=!1,this.readLoopPromise=null,this.errorLog=[],this.isBusy=!0,this.isConnected=!1,this.isEchoing=!0,this.isTalking=!1,this.mode=">",this.version=null,this.str=""}async connect(){var e,t;this.isBusy=!0,this.port=await navigator.serial.requestPort({usbVendorId:7071}),await this.port.open({baudRate:115200,dataBits:8,parity:"none",stopBits:1,flowControl:"none"}),null!=(null==(e=this.port)?void 0:e.writable)?null!=(null==(t=this.port)?void 0:t.readable)?(this.reader=this.port.readable.getReader(),this.writer=this.port.writable.getWriter(),this.startReadLoop(),await this.sleep(100),await this.synchronize(),this.isConnected=!0,this.isBusy=!1,console.log("ready")):this.errorLog.push("This is not a readable port."):this.errorLog.push("This is not a writable port.")}async disconnect(){await this.stopReadLoop(),await this.writer.releaseLock(),await this.reader.releaseLock(),await this.port.close()}async synchronize(){this.writer.write(this.encoder.encode("")),console.log("wrote escape"),await this.sleep(100);let e=await this.flush();console.log("escape result",e),1===e.length&&(e=e.pop(),">"!==e&&"$"!==e||(this.mode=e,console.log("mode set to",e)));let t=3;for(;t>0;){await this.sleep(100);const e=await this.getVersion();if("string"==typeof e){this.version=e;break}t--}this.isEchoing&&await this.turnOffEcho()}async getVersion(){const e=await this.write("version()");for(const t of e)if(console.log("line",t,(t.match(/\./g)||[]).length),t.startsWith("v")&&2===(t.match(/\./g)||[]).length)return t}async turnOffEcho(){this.isEchoing&&(await this.write("echo(0)"),this.isEchoing=!1)}sleep(e){return new Promise((t=>setTimeout(t,e)))}startReadLoop(){this.readLoopPromise=this.readLoop()}async stopReadLoop(){this.readLoopActive=!1,this.readLoopPromise&&(await this.reader.cancel(),await this.readLoopPromise,this.readLoopPromise=null)}async readLoop(){let e;for(this.readLoopActive=!0;this.readLoopActive;)try{const{value:t,done:s}=await this.reader.read();if(console.log("Reading..."),this.str+=this.decoder.decode(t).replace("\r",""),!this.str)continue;let i=this.str.indexOf("\n");for(i>-1?this.str.split("\n").forEach((e=>console.log("->",e))):console.log("->",this.str);i>-1;)e=this.str.substring(0,i),e&&(console.log("queued:",e),this.queue.push(e)),this.str=this.str.substring(i+1),i=this.str.indexOf("\n");">"!==this.str&&"$"!==this.str||(console.log("queued:",this.str),this.queue.push(this.str),this.str=""),s&&(this.readLoopActive=!1)}catch(t){console.error(t);break}}readUntil(e){return new Promise((async t=>{const s=[];let i;do{if(i=await this.queue.pop().catch((()=>{console.log("read until","queue waiter terminated",s),t(s)})),i.startsWith("!")){console.log("Error:",i);break}s.push(i)}while(i!==e);console.log("read until","found",s),s.length>1&&s.pop(),t(s)}))}async flush(){const e=[];let t;do{t=await this.queue.tryPop(),t&&e.push(t)}while(t);return e.length||(this.str=""),console.log("flushed",e),e}async escape(){this.isBusy=!0,this.queue.cancelWait(new Error("Escape")),await this.write("",""),this.isBusy=!1}async write(e,t="\n"){console.log("----- write -----"),this.isTalking=!0,await this.flush(),this.writer.write(this.encoder.encode(e+t)),console.log("wrote",e),">"!==e&&"$"!==e||(this.mode=e),console.log("write is sleeping"),await this.sleep(50),console.log("write is reading");const s=await this.readUntil(this.mode);return this.isTalking=!1,console.log("write result",s),s}}const k={class:"grid lg:grid-cols-2 gap-4 bg-gray-200"},L={class:"col-span-1 space-y-4"},x={class:"mb-4 flex items-center space-x-2"},C=["disabled"],E={class:"flex divide-x-2 divide-gray-200"},P=["disabled"],q=["disabled"],T=["disabled"],W=["disabled"],R=["disabled"],B={class:"px-2"},O={key:1,class:"bg-white w-full h-[480px]"},A={class:"space-y-2"},D={class:"flex"},N={class:"bg-gray-300 px-2.5 py-1"},V=["disabled","onKeyup"],$=["disabled"],j={key:0,class:"bg-white bg-opacity-50 px-2 py-1 font-mono whitespace-pre-wrap"},S={class:"col-span-1 space-y-4"},U={class:"flex divide-x divide-blue-400"},z=["disabled"],I={key:1,class:"text-gray-500"},K={class:"flex divide-x-2 divide-gray-200"},M=["disabled"],F=["disabled"],H={setup(e){const y={input:null},b=t(""),H=t(""),G=t(null),J=t(1),Q=t(1),X=t("javascript"),Y=s(new m),Z=t([]),_=t(null),ee=i((()=>!Y.isConnected||Y.isBusy||Y.isTalking));async function te(){console.log("sendRecordMode"),await Y.write("$");const e=b.value.replace("\r","").split("\n");for(const t of e)await Y.write(t);await Y.write("run")}async function se(){console.log("sendDirectMode");const e=await Y.write(H.value);Z.value.push(...e),_.value=H.value,H.value="",y.input.focus()}async function ie(){console.log("sendNew"),await Y.write("new"),_.value="",Z.value=[]}async function oe(){console.log("sendRun"),await Y.write("run")}async function ae(){console.log("sendList");const e=await Y.write("list");Z.value.push(...e)}async function ne(){console.log("testPrint"),await Y.write(">");const e=await Y.write('print("Hello World")');Z.value.push(...e)}async function re(){console.log("testDigitalWrite");const e=["for x = 1 to 10","DWrite(100,1)","Wait(200)","DWrite(100,0)","Wait(200)","next"];await Y.write("$");for(const t of e)await Y.write(t);await Y.write("run")}async function le(){console.log("sendEscape"),await Y.escape()}function ce(e){e.setOptions({fontSize:"16px"}),e.session.selection.on("changeCursor",(()=>{const t=e.getCursorPosition();J.value=t.row+1,Q.value=t.column+1})),e.value=e}return(e,t)=>(v(),o("div",k,[a("div",L,[a("div",x,[a("button",{disabled:n(Y).isConnected,onClick:t[0]||(t[0]=(...e)=>n(Y).connect&&n(Y).connect(...e))},"Connect",8,C),a("div",E,[a("button",{disabled:n(ee),onClick:ie},"New",8,P),a("button",{disabled:n(ee),onClick:te},"Send",8,q),a("button",{disabled:n(ee),onClick:oe},"Run",8,T),a("button",{disabled:n(ee),onClick:ae},"List",8,W)]),a("button",{disabled:!n(Y).isConnected||n(Y).isBusy,onClick:le},"Esc",8,R),a("div",B,r(n(Y).version),1)]),n(Y).isConnected?(v(),l(n(c),{key:0,value:b.value,"onUpdate:value":t[1]||(t[1]=e=>b.value=e),lang:X.value,class:"w-full h-[480px]",ref:G,onInit:ce},null,8,["value","lang"])):(v(),o("div",O)),a("div",A,[a("div",D,[a("div",N,r(n(Y).mode),1),d(a("input",{disabled:n(ee),ref:e=>y.input=e,"onUpdate:modelValue":t[2]||(t[2]=e=>H.value=e),type:"text",class:"flex-1",onKeyup:h(se,["enter"])},null,40,V),[[u,H.value]]),a("button",{disabled:n(ee),onClick:se},"Send",8,$)]),_.value?(v(),o("div",j,r(_.value),1)):p("",!0)])]),a("div",S,[a("div",U,[a("button",{disabled:n(ee),onClick:t[3]||(t[3]=e=>Z.value=[])},"Clear Output",8,z)]),a("div",{class:w(["w-full h-[480px] p-4 bg-black overflow-y-auto whitespace-pre-wrap text-white",n(Y).isConnected?"":"opacity-40"])},[Z.value.length?(v(),o(g,{key:0},[f(r(Z.value.join("\n")),1)],64)):(v(),o("span",I," No output "))],2),a("div",K,[a("button",{disabled:n(ee),class:"tester",onClick:ne},"Test Print",8,M),a("button",{disabled:n(ee),class:"tester",onClick:re},"Test Digital Write",8,F)])])]))}};window.ace=y,b(H).mount("#app");
