import{C as e,r as t,a as s,c as i,b as a,u as n,t as o,d as r,V as l,n as d,w as c,v as u,e as h,F as p,o as w,f,g as v}from"./vendor.30d16391.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class b{constructor(){this.errorLog=[],this.port=null,this.reader=null,this.writer=null,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.queue=new e,this.readLoopActive=!1,this.readLoopPromise=null,this.output=[],this.isConnected=!1,this.echo=!0,this.version=null,this.readTimeout=3e3,this.leftOver=""}async connect(){this.port=await navigator.serial.requestPort({usbVendorId:7071});try{await this.attach()}catch(e){this.errorLog.push(e),this.port=null}this.startReadLoop(),this.leftOver="",await this.sleep(100),await this.synchronize(),this.isConnected=!0}async disconnect(){await this.detach()}async synchronize(){await this.send("",""),await this.send(">");let e=3;for(;e>0;){await this.sleep(100);const t=await this.getVersion();if("string"==typeof t){this.version=t;break}e--}}async getVersion(){await this.send("version()");const e=await this.readUntilEmpty();return this.echo?(await this.turnOffEcho(),e[1]):e[0]}async turnOffEcho(){this.echo&&(await this.send("echo(0)"),await this.readUntilEmpty(),this.echo=!1)}async attach(){var e,t;await this.port.open({baudRate:115200,dataBits:8,parity:"none",stopBits:1,flowControl:"none"}),null==(null==(e=this.port)?void 0:e.writable)&&this.errorLog.push("This is not a writable port."),null==(null==(t=this.port)?void 0:t.readable)&&this.errorLog.push("This is not a readable port."),this.reader=this.port.readable.getReader(),this.writer=this.port.writable.getWriter()}async detach(){await this.stopReadLoop(),await this.writer.releaseLock(),await this.reader.releaseLock(),await this.port.close()}async sleep(e){await new Promise((t=>setTimeout(t,e)))}startReadLoop(){this.readLoopPromise=this.readLoop()}async stopReadLoop(){this.readLoopActive=!1,this.readLoopPromise&&(await this.reader.cancel(),await this.readLoopPromise,this.readLoopPromise=null)}async readResponse(){let e=this.leftOver;const t=Date.now()+this.readTimeout,s={success:!1,response:null};for(;Date.now()<t;){const{value:t}=await this.reader.read();e+=this.decoder.decode(t),e=e.replace("\n",""),e=e.replace("\r","");let i=e.indexOf(">"),a=e.indexOf("&");if(-1===i&&(i=e.indexOf("$")),-1===i&&-1===a)continue;const n=-1===i?a:i;console.log("----------",n),console.log(e),console.log("----------"),console.log(n+1,e.length,e.substring(n+1,e.length)),console.log("----------"),console.log(0,n,e.substring(0,n)),this.leftOver=e.substring(n+1),s.success=!0,s.response=e.substring(0,n);return-1!==e.indexOf("!")&&(s.response.indexOf("error")>-1||s.response.indexOf("unknown")>-1)&&(s.success=!1),s}return this.leftOver="",s}async readLoop(){let e,t="";for(this.readLoopActive=!0;this.readLoopActive;)try{const{value:s,done:i}=await this.reader.read();if(s){t+=this.decoder.decode(s);let i=t.indexOf("\n");for(;i>0;){for(e=t.substring(0,i).replace("\r","");e.startsWith(">")||e.startsWith("$");)e=e.substring(1);console.log(">>",e),this.queue.push(e),t=t.substring(i+1),i=t.indexOf("\n")}}i&&(this.readLoopActive=!1)}catch(s){console.error(s);break}}async readUntilEmpty(){const e=[];let t;do{t=await this.queue.tryPop(),t&&e.push(t)}while(t);return e}async send(e,t="\n"){console.log(e),await this.readUntilEmpty(),this.writer.write(this.encoder.encode(e+t)),await this.sleep(10)}}const y={class:"mb-4 flex space-x-2"},g=["disabled"],m={class:"grid grid-cols-2 gap-4 bg-gray-200"},C={class:"col-span-1 space-y-4"},x={key:1,class:"bg-white w-full h-[600px]"},L={class:"flex justify-between"},k=["disabled"],O={class:"flex divide-x divide-gray-400"},E=["disabled"],P=["disabled"],U=["disabled"],S={class:"col-span-1 space-y-4"},T={class:"flex divide-x divide-gray-400"},W=["disabled"],R={class:"col-span-1  space-y-4"},A={class:"flex"},D=["disabled"],q=["disabled"],V={key:0,class:"bg-gray-300 px-2 py-1"},j={class:"flex divide-x divide-gray-400"},N=["disabled"],$=["disabled"],z=["disabled"],I={setup(e){const f=t(""),v=t(""),I=t(null),B=t(1),F=t(1),H=t("javascript"),K=s(new b),M=t([]),G=t(null);async function J(){console.log("Send recording mode code"),await K.send("$");const e=f.value.replace("\r","").split("\n");for(const t of e)await K.send(t);await K.send("run")}async function Q(){console.log("Send immediate mode code"),await K.send(v.value),M.value.push(await K.readUntilEmpty()),G.value=v.value,v.value=""}async function X(){console.log("Send new"),await K.send(">"),await K.send("new"),await K.readUntilEmpty()}async function Y(){console.log("Send run"),await K.send(">"),await K.send("run"),await K.readUntilEmpty()}async function Z(){console.log("Send list"),await K.send(">"),await K.send("list"),await K.sleep(50),M.value.push(...await K.readUntilEmpty())}async function _(){await K.send(">"),await K.send('print("Hello World")'),M.value.push(await K.readUntilEmpty())}async function ee(){const e=["for x = 1 to 10","DWrite(100,1)","Wait(200)","DWrite(100,0)","Wait(200)","next"];await K.send("$");for(const t of e)await K.send(t);await K.send("run")}async function te(){console.log("Send escape"),await K.send("","")}function se(e){e.setOptions({fontSize:"16px"}),e.session.selection.on("changeCursor",(()=>{const t=e.getCursorPosition();B.value=t.row+1,F.value=t.column+1})),e.value=e}return(e,t)=>(w(),i(p,null,[a("div",y,[a("button",{disabled:n(K).isConnected,onClick:t[0]||(t[0]=(...e)=>n(K).connect&&n(K).connect(...e))},"Connect",8,g),a("div",null,o(n(K).version),1)]),a("div",m,[a("div",C,[n(K).isConnected?(w(),r(n(l),{key:0,value:f.value,"onUpdate:value":t[1]||(t[1]=e=>f.value=e),lang:H.value,class:"w-full h-[600px]",disabled:!n(K).isConnected,ref:I,onInit:se},null,8,["value","lang","disabled"])):(w(),i("div",x)),a("div",L,[a("button",{disabled:!n(K).isConnected,onClick:J},"Send",8,k),a("div",O,[a("button",{disabled:!n(K).isConnected,onClick:X},"New",8,E),a("button",{disabled:!n(K).isConnected,onClick:Y},"Run",8,P),a("button",{disabled:!n(K).isConnected,onClick:Z},"List",8,U)])])]),a("div",S,[a("div",{class:d(["w-full h-[600px] p-4 bg-black overflow-y-auto whitespace-pre-wrap text-white",n(K).isConnected?"":"opacity-40"])},o(M.value.join("\n")),3),a("div",T,[a("button",{disabled:!n(K).isConnected,onClick:t[2]||(t[2]=e=>M.value=[])},"Clear",8,W)])]),a("div",R,[a("div",A,[c(a("input",{disabled:!n(K).isConnected,"onUpdate:modelValue":t[3]||(t[3]=e=>v.value=e),type:"text",class:"flex-1"},null,8,D),[[u,v.value]]),a("button",{disabled:!n(K).isConnected,onClick:Q},"Send",8,q)]),G.value?(w(),i("div",V,o(G.value),1)):h("",!0),a("div",j,[a("button",{disabled:!n(K).isConnected,onClick:_},"Test Print",8,N),a("button",{disabled:!n(K).isConnected,onClick:ee},"Test Digital Write",8,$),a("button",{disabled:!n(K).isConnected,onClick:te},"Escape",8,z)])])])],64))}};window.ace=f,v(I).mount("#app");
